<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <!--
    XRBitcoinCash Trade & AMM Dashboard
    Single-file build: Wallet Connect (Xaman/Xumm), Trustline, DEX (offers & swaps), AMM (create/deposit/withdraw),
    embedded market widgets, simulation fallbacks, and a PayPal placeholder (commented for later).
    Replace placeholders where marked TODO.
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XRBitcoinCash · Wallet · DEX · AMM</title>
  <meta name="description" content="Connect Xaman/Xumm, set trustline, trade XRBitcoinCash on XRPL, and manage liquidity in the AMM pool." />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://xrbitcoincash.com/trade" />
  <meta property="og:title" content="XRBitcoinCash · Wallet · DEX · AMM" />
  <meta property="og:description" content="Connect wallet, trade XRBC, and manage liquidity pools directly on XRPL." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630'%3E%3Crect width='100%25' height='100%25' fill='%230b1118'/%3E%3Ctext x='50%25' y='50%25' fill='%23a7ff83' font-family='Segoe UI,Arial' font-size='56' text-anchor='middle' dominant-baseline='middle'%3EXRBitcoinCash DEX%3C/text%3E%3C/svg%3E" />
  <meta name="theme-color" content="#0b1118" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 64 64%27%3E%3Cdefs%3E%3CradialGradient id=%27g%27 cx=%2750%25%27 cy=%2750%25%27 r=%2750%25%27%3E%3Cstop offset=%270%25%27 stop-color=%27%235af7ff%27/%3E%3Cstop offset=%27100%25%27 stop-color=%27%230b1118%27/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx=%2732%27 cy=%2732%27 r=%2732%27 fill=%27url(%23g)%27/%3E%3Cpath d=%27M16 32h32M22 22h20M22 42h20%27 stroke=%27%23a7ff83%27 stroke-width=%273%27 stroke-linecap=%27round%27/%3E%3C/svg%3E" />

  <style>
    /* =========================
       THEME TOKENS & BASE STYLES
       ========================= */
    :root {
      --bg: #0b1118;
      --bg-soft: #101824;
      --panel: #0f1722;
      --panel-2: #121c2a;
      --text: #e7eef8;
      --muted: #9bb1c9;
      --brand: #a7ff83;
      --accent: #5af7ff;
      --ok: #31d0aa;
      --warn: #f7b500;
      --danger: #ff6b6b;
      --ring: 0 0 0 2px rgba(167,255,131,0.28);
      --shadow: 0 16px 60px rgba(0,0,0,0.35);
      --radius-xl: 18px;
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
      --grid-gap: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Inter, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    }
    [data-theme="light"] {
      --bg: #f5f7fb;
      --bg-soft: #edf2f8;
      --panel: #ffffff;
      --panel-2: #f7fbff;
      --text: #0e1726;
      --muted: #5a6b7e;
      --brand: #2ea043;
      --accent: #005fcc;
      --shadow: 0 16px 45px rgba(12,28,50,0.12);
      --ring: 0 0 0 2px rgba(0,95,204,0.25);
    }
    *,*::before,*::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(90,247,255,0.06), transparent),
        radial-gradient(900px 500px at 90% -10%, rgba(167,255,131,0.06), transparent),
        var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.5;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    img,svg { display: block; max-width: 100%; }
    input,button,select,textarea { font: inherit; }
    button { cursor: pointer; }

    /* =========================
       LAYOUT
       ========================= */
    .app {
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100dvh;
    }
    header.appbar {
      position: sticky; top: 0; z-index: 50;
      background: linear-gradient(180deg, rgba(11,17,24,0.92), rgba(11,17,24,0.6));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid rgba(167,255,131,0.15);
    }
    .wrap { max-width: 1240px; margin: 0 auto; padding: 14px 18px; }
    .row { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }
    nav.topnav { display: flex; align-items:center; gap: 8px; flex-wrap: wrap; }
    main { padding: 18px; }
    .grid { display: grid; gap: var(--grid-gap); }
    .cols-3 { grid-template-columns: 2fr 1fr 1fr; }
    .cols-2 { grid-template-columns: 2fr 1fr; }
    .cols-1 { grid-template-columns: 1fr; }

    @media (max-width: 1140px) { .cols-3 { grid-template-columns: 1.5fr 1fr; } }
    @media (max-width: 920px) {
      .row { grid-template-columns: 1fr; }
      nav.topnav { order: 3; }
      .cols-3, .cols-2 { grid-template-columns: 1fr; }
    }

    /* =========================
       COMPONENTS
       ========================= */
    .brand { display: flex; align-items: center; gap: 12px; }
    .brand .logo {
      width: 40px; height: 40px; border-radius: 50%;
      background: radial-gradient(32px 32px at 50% 50%, rgba(90,247,255,0.25), rgba(11,17,24,0.1));
      border: 1px solid rgba(90,247,255,0.25);
      display: grid; place-items: center;
    }
    .brand h1 { margin: 0; font-size: 18px; letter-spacing: .4px; font-weight: 800; }
    .chip {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 9999px;
      border: 1px solid rgba(90,247,255,0.18);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      color: var(--text); font-weight: 600; font-size: 13px;
      transition: transform .12s ease, border-color .12s ease;
    }
    .chip:hover { transform: translateY(-1px); border-color: rgba(167,255,131,0.35); }
    .btn {
      appearance: none;
      border: 1px solid rgba(167,255,131,0.25);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      color: var(--text); font-weight: 700; letter-spacing: .2px;
      padding: 10px 14px; border-radius: 12px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease, color .12s ease;
    }
    .btn:hover { transform: translateY(-1px); border-color: var(--brand); }
    .btn.brand {
      background: linear-gradient(180deg, rgba(167,255,131,0.14), rgba(90,247,255,0.10));
      border-color: rgba(90,247,255,0.25);
    }
    .btn.ghost { background: transparent; }
    .btn.danger { border-color: rgba(255,107,107,0.45); color: #ffdada; }

    .panel {
      border: 1px solid rgba(90,247,255,0.16);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: var(--shadow);
      overflow: clip;
    }
    .panel .head {
      display: flex; align-items: center; justify-content: space-between; gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(167,255,131,0.12);
      background: linear-gradient(180deg, rgba(90,247,255,0.06), transparent);
    }
    .panel .head h3 { margin: 0; font-size: 16px; letter-spacing: .3px; }
    .panel .body { padding: 14px; }

    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    input[type="text"], input[type="number"], input[type="search"], input[type="url"], input[type="email"], select, textarea {
      width: 100%; padding: 10px 12px; border-radius: 10px;
      border: 1px solid rgba(167,255,131,0.15);
      background: rgba(16,24,36,0.6); color: var(--text);
    }
    input::placeholder, textarea::placeholder { color: #6f86a3; }

    .mono { font-family: var(--mono); }
    .pill {
      display: inline-flex; align-items:center; gap: 6px;
      padding: 6px 8px; border-radius: 9999px; font-size: 12px;
      border: 1px solid rgba(167,255,131,0.18);
      background: rgba(16,24,36,0.6);
      color: var(--muted);
    }
    .toolbar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .table {
      width: 100%;
      border-collapse: collapse;
      border: 1px solid rgba(90,247,255,0.16);
      border-radius: 10px;
      overflow: hidden;
    }
    .table th, .table td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(167,255,131,0.10);
      font-size: 13px;
    }
    .table thead { background: rgba(90,247,255,0.06); }
    .muted { color: var(--muted); }
    .ok { color: var(--ok); }
    .warn { color: var(--warn); }
    .danger { color: var(--danger); }
    .success {
      border: 1px solid rgba(49,208,170,0.35);
      background: rgba(49,208,170,0.10);
      color: #aef3e1;
      padding: 10px;
      border-radius: 10px;
    }
    .error {
      border: 1px solid rgba(255,107,107,0.35);
      background: rgba(255,107,107,0.10);
      color: #ffdada;
      padding: 10px; border-radius: 10px;
    }
    .notice {
      border: 1px solid rgba(247,181,0,0.35);
      background: rgba(247,181,0,0.10);
      color: #ffe8b3;
      padding: 10px; border-radius: 10px;
    }

    footer {
      border-top: 1px solid rgba(167,255,131,0.15);
      color: var(--muted);
      font-size: 12px;
      text-align: center;
      padding: 12px;
      background: linear-gradient(180deg, rgba(16,24,36,0.9), rgba(16,24,36,0.9));
    }

    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    @media (max-width: 840px) { .grid-2,.grid-3 { grid-template-columns: 1fr; } }

    .hero {
      border: 1px solid rgba(90,247,255,0.16);
      border-radius: var(--radius-xl);
      background:
        radial-gradient(900px 500px at 0% -30%, rgba(90,247,255,0.08), transparent),
        radial-gradient(900px 500px at 100% -30%, rgba(167,255,131,0.08), transparent),
        linear-gradient(180deg, rgba(16,24,36,0.9), rgba(16,24,36,0.82));
      overflow: hidden;
    }
    .hero-inner { display:grid; grid-template-columns: 1.3fr 1fr; gap: 20px; padding: 22px; }
    .kpis { display:grid; grid-template-columns: repeat(3,1fr); gap: 12px; margin-top: 8px; }
    .kpi { padding: 14px; border-radius: 12px; border:1px solid rgba(167,255,131,0.15); background: linear-gradient(180deg, var(--panel), var(--panel-2)); }
    .kpi .label { color:var(--muted); font-size:12px; }
    .kpi .value { font-family: var(--mono); font-size:18px; margin-top:4px; letter-spacing:.2px; }

    .glow { animation: pulseGlow 2.2s infinite; }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(167,255,131,0.22); }
      70% { box-shadow: 0 0 0 12px rgba(167,255,131,0); }
      100% { box-shadow: 0 0 0 0 rgba(167,255,131,0); }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- =========================
         APP BAR
         ========================= -->
    <header class="appbar">
      <div class="wrap">
        <div class="row">
          <div class="brand">
            <div class="logo" aria-hidden="true">
              <svg viewBox="0 0 24 24" role="img" aria-label="XRBC logo">
                <circle cx="12" cy="12" r="10" fill="#0b1118"></circle>
                <path d="M6 12h12M8 8h8M8 16h8" stroke="#a7ff83" stroke-width="2" stroke-linecap="round"></path>
              </svg>
            </div>
            <div>
              <h1>XRBitcoinCash · Trade & AMM</h1>
              <small class="muted mono">XRPL Mainnet tooling · Xaman/Xumm connect</small>
            </div>
          </div>
          <div class="actions">
            <nav class="topnav" aria-label="Primary">
              <a class="chip" href="#/home">Home</a>
              <a class="chip" href="#/wallet">Wallet</a>
              <a class="chip" href="#/trustline">Trustline</a>
              <a class="chip" href="#/dex">DEX</a>
              <a class="chip" href="#/amm">AMM</a>
              <a class="chip" href="#/market">Market</a>
              <a class="chip" href="#/settings">Settings</a>
            </nav>
           <button id="connectWalletButton">Connect Wallet</button>
<button id="logoutButton" style="display:none;">Logout</button>
<div id="walletAddress">Status: Not connected</div>
<div id="status"></div>

      </div>
    </header>

    <!-- =========================
         MAIN CONTENT
         ========================= -->
    <main>
      <div class="wrap grid cols-1" id="routeHost">

        <!-- ===== HOME ===== -->
        <section class="hero" data-route="home">
          <div class="hero-inner">
            <div>
              <span class="pill">XRPL · Decentralized Trading</span>
              <h2>Trade XRBitcoinCash and manage liquidity</h2>
              <p>Connect Xaman/Xumm, set your trustline, place decentralized trades, and join the XRPL AMM pool for XRBC.</p>
              <div class="kpis">
                <div class="kpi">
                  <div class="label">Wallet</div>
                  <div class="value" id="kpiWallet">Not connected</div>
                </div>
                <div class="kpi">
                  <div class="label">XRBC Price</div>
                  <div class="value" id="kpiPrice">—</div>
                </div>
                <div class="kpi">
                  <div class="label">Pool TVL</div>
                  <div class="value" id="kpiTVL">—</div>
                </div>
              </div>
              <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap;">
                <a class="btn brand glow" href="#/wallet">Open Wallet</a>
                <a class="btn" href="#/trustline">Set Trustline</a>
                <a class="btn" href="#/dex">Trade</a>
                <a class="btn" href="#/amm">Add Liquidity</a>
              </div>
            </div>
            <div class="panel">
              <div class="head"><h3>Status</h3><div class="pill">Network: <span id="pillNetwork">Disconnected</span></div></div>
              <div class="body">
                <div id="status" class="notice">Initialize wallet connection to start.</div>
                <div style="margin-top:10px;" class="muted">Tip: You can browse Market for demo data without a wallet.</div>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== WALLET ===== -->
        <section class="panel" data-route="wallet" hidden>
          <div class="head">
            <h3>Wallet</h3>
            <div class="toolbar">
              <div class="pill">Xaman/Xumm SDK</div>
              <div class="pill">XRPL Client</div>
            </div>
          </div>
          <div class="body grid-2">
            <div>
              <label>Account</label>
              <div id="walletAddress" class="mono">—</div>
              <div class="toolbar" style="margin-top:10px;">
                <button class="btn brand" id="btnAuthorize">Connect</button>
                <button class="btn" id="btnLogout" disabled>Logout</button>
              </div>
              <div style="margin-top:10px;">
                <div class="success" id="walletHints">Xaman SDK ready. Connect to link your wallet.</div>
              </div>
              <div style="margin-top:10px;">
                <label>XRPL Endpoint</label>
                <input id="rpcEndpoint" type="text" class="mono" />
                <div class="toolbar" style="margin-top:8px;">
                  <button class="btn" id="btnConnectXRPL">Connect XRPL</button>
                  <div class="pill">Client: <span id="xrplConn">offline</span></div>
                </div>
              </div>
            </div>
            <div>
              <label>Balances (demo)</label>
              <div id="walletBalances" class="mono">—</div>
              <div style="margin-top:8px;" class="muted">Balances are simulated until XRPL client is connected and queried.</div>
              <div style="margin-top:10px;">
                <label>XUMM Deeplink (TrustSet)</label>
                <div id="xummDeeplink" class="mono" style="word-break: break-all;">—</div>
                <div class="toolbar" style="margin-top:8px;">
                  <button class="btn" id="btnOpenXumm" disabled>Open in Xaman</button>
                  <button class="btn" id="btnCopyLink" disabled>Copy link</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== TRUSTLINE ===== -->
        <section class="panel" data-route="trustline" hidden>
          <div class="head">
            <h3>Trustline</h3>
            <div class="toolbar">
              <div class="pill">Currency: XRbitcoincash</div>
              <div class="pill">Issuer: <span class="mono" id="issuerShort">—</span></div>
            </div>
          </div>
          <div class="body grid-2">
            <div>
              <div class="grid-2">
                <div>
                  <label>Token code</label>
                  <input id="tlCode" type="text" class="mono" />
                </div>
                <div>
                  <label>Issuer</label>
                  <input id="tlIssuer" type="text" class="mono" />
                </div>
                <div>
                  <label>Limit</label>
                  <input id="tlLimit" type="text" class="mono" />
                </div>
                <div>
                  <label>Encoding</label>
                  <div class="pill">160-bit (hex) if code length > 3</div>
                </div>
              </div>
              <div class="toolbar" style="margin-top:10px;">
                <button class="btn brand" id="btnBuildTrust">Build TrustSet</button>
                <button class="btn" id="btnSignTrust" disabled>Sign (Xumm)</button>
              </div>
              <div style="margin-top:10px;">
                <label>Prepared TX</label>
                <textarea id="trustTx" rows="8" class="mono" placeholder="TrustSet JSON will appear here"></textarea>
              </div>
            </div>
            <div>
              <label>Deeplink</label>
              <textarea id="trustDeeplink" rows="4" class="mono" placeholder="xumm:// ..."></textarea>
              <div class="toolbar" style="margin-top:8px;">
                <button class="btn" id="btnOpenTrustLink" disabled>Open in Xaman</button>
                <button class="btn" id="btnCopyTrustLink" disabled>Copy</button>
              </div>
              <div style="margin-top:10px;" id="trustStatus" class="notice">Build the transaction to enable actions.</div>
            </div>
          </div>
        </section>

        <!-- ===== DEX ===== -->
        <section class="panel" data-route="dex" hidden>
          <div class="head">
            <h3>Decentralized Exchange (XRPL)</h3>
            <div class="toolbar">
              <div class="pill">Pair: XRBC/XRP</div>
              <div class="pill">Mode: Demo until XRPL connected</div>
            </div>
          </div>
          <div class="body grid-2">
            <div>
              <div class="grid-3">
                <div>
                  <label>Order Type</label>
                  <select id="tradeType">
                    <option value="buy">Buy XRBC with XRP</option>
                    <option value="sell">Sell XRBC for XRP</option>
                  </select>
                </div>
                <div>
                  <label>Amount (XRBC)</label>
                  <input id="tradeAmount" type="number" min="0" step="0.000001" placeholder="e.g., 100.0" />
                </div>
                <div>
                  <label>Price (XRP per XRBC)</label>
                  <input id="tradePrice" type="number" min="0" step="0.000001" placeholder="e.g., 0.0123" />
                </div>
              </div>
              <div class="toolbar" style="margin-top:8px;">
                <button class="btn brand" id="tradeBtn" disabled>Submit Order</button>
                <button class="btn" id="swapBtn" disabled>Quick Swap (Path Payment)</button>
              </div>
              <div class="success" style="margin-top:8px;">Orders and swaps require trustline and wallet connection.</div>

              <div style="margin-top:14px;">
                <label>Orderbook</label>
                <table class="table" id="orderbookTable" aria-label="Orderbook">
                  <thead><tr><th>Side</th><th>Price (XRP)</th><th>Amount (XRBC)</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>

              <div style="margin-top:14px;">
                <label>Recent Trades</label>
                <table class="table" id="tradesTable" aria-label="Recent trades">
                  <thead><tr><th>Time</th><th>Side</th><th>Price</th><th>Amount (XRBC)</th></tr></thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <div>
              <label>XPMarket Widget</label>
              <iframe title="XPMarket - XRBC market"
                      src="https://xpmarket.com/market/XRBC"
                      style="width:100%;height:420px;border:none;border-radius:12px; background:#0e1624;"></iframe>
              <div style="margin-top:10px;">
                <label>Sologenic Profile</label>
                <a class="chip" target="_blank" rel="noopener" href="https://sologenic.org/profile/xrbitcoincash.com?network=mainnet">Open Sologenic Profile</a>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== AMM ===== -->
        <section class="panel" data-route="amm" hidden>
          <div class="head">
            <h3>AMM · Liquidity Pool</h3>
            <div class="toolbar">
              <div class="pill">Trading Fee: 0.30% (example)</div>
              <div class="pill">Pool: XRBC ↔ XRP</div>
            </div>
          </div>
          <div class="body grid-2">
            <div>
              <div class="grid-3">
                <div>
                  <label>Initial Tokens (XRBC)</label>
                  <input id="ammInitToken" type="number" step="0.000001" placeholder="e.g., 1000" />
                </div>
                <div>
                  <label>Initial XRP (drops)</label>
                  <input id="ammInitXRP" type="number" step="1" placeholder="e.g., 100000000 (100 XRP)" />
                </div>
                <div>
                  <label>Fee (bps)</label>
                  <input id="ammFee" type="number" step="1" value="30" />
                </div>
              </div>
              <div class="toolbar" style="margin-top:10px;">
                <button class="btn brand" id="btnCreatePool" disabled>Create Pool</button>
                <button class="btn" id="btnRefreshPool">Refresh Info</button>
              </div>

              <div class="grid-3" style="margin-top:16px;">
                <div>
                  <label>Deposit XRBC</label>
                  <input id="lpXRBC" type="number" step="0.000001" placeholder="e.g., 500" />
                </div>
                <div>
                  <label>Deposit XRP (drops)</label>
                  <input id="lpXRP" type="number" step="1" placeholder="e.g., 50000000 (50 XRP)" />
                </div>
                <div>
                  <label>LP Tokens</label>
                  <input id="lpTokens" type="number" step="0.000001" placeholder="e.g., 50" />
                </div>
              </div>
              <div class="toolbar" style="margin-top:10px;">
                <button class="btn brand" id="lpDepositBtn" disabled>Add Liquidity</button>
                <button class="btn" id="lpWithdrawBtn" disabled>Withdraw Liquidity</button>
              </div>

              <div style="margin-top:10px;">
                <label>Your LP Summary (demo)</label>
                <div id="myLpBalance" class="mono">—</div>
              </div>
            </div>

            <div>
              <label>Pool Info</label>
              <div id="ammInfo" class="mono">—</div>
              <div style="margin-top:10px;">
                <label>Pool Stats</label>
                <div id="poolStats" class="mono">—</div>
              </div>
            </div>
          </div>
        </section>

        <!-- ===== MARKET ===== -->
        <section class="panel" data-route="market" hidden>
          <div class="head">
            <h3>Market Overview</h3>
            <div class="toolbar">
              <div class="pill">XRBC/USD (computed)</div>
              <div class="pill">XRPL mainnet</div>
            </div>
          </div>
          <div class="body grid-2">
            <div>
              <label>Ticker</label>
              <div id="ticker" class="mono">—</div>
              <div class="success" style="margin-top:8px;">Price feed is simulated until XRPL/markets are connected.</div>
            </div>
            <div>
              <label>Balances</label>
              <div id="demoBalances" class="mono">—</div>
              <div class="muted" style="margin-top:8px;">XRBC and XRP shown for demo. Connect wallet for live values.</div>
            </div>
          </div>
        </section>

        <!-- ===== SETTINGS ===== -->
        <section class="panel" data-route="settings" hidden>
          <div class="head">
            <h3>Settings</h3>
            <div class="toolbar"><div class="pill">Local persistence</div></div>
          </div>
          <div class="body grid-2">
            <div class="panel">
              <div class="head"><h3>Theme</h3></div>
              <div class="body">
                <div class="toolbar">
                  <button class="btn" data-theme="dark">Dark</button>
                  <button class="btn" data-theme="light">Light</button>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="head"><h3>Data</h3></div>
              <div class="body">
                <div class="toolbar">
                  <button class="btn danger" id="btnResetData">Reset</button>
                  <button class="btn" id="btnExport">Export</button>
                  <button class="btn" id="btnImport">Import</button>
                </div>
                <textarea id="dataBlob" rows="8" class="mono" placeholder="Data JSON export/import area"></textarea>
              </div>
            </div>
          </div>
          <!-- PayPal Placeholder (intentionally commented)
          <div class="panel" style="margin-top:12px;">
            <div class="head"><h3>PayPal (placeholder)</h3><div class="pill">To be implemented</div></div>
            <div class="body">
              <!-- Insert PayPal SDK & purchase flow here. Track fiat → crypto rate, KYC, and on-chain issuance/escrow. -->
            </div>
          </div>
          -->
        </section>

      </div>
    </main>

    <footer>
      © 2025 XRBitcoinCash · Verify issuers and payloads before signing. This dashboard includes demo simulations and placeholders.
    </footer>
  </div>

  <!-- =========================
       CONFIG (INLINE JSON)
       ========================= -->
  <script type="application/json" id="app-config">
  {
    "issuerAddress": "rEjwniYhYR5QDZzK1a1x2359j8j8N43Ypw",
    "tokenCode": "XRbitcoincash",
    "tokenLimit": "20999999.999999996",
    "rpcEndpoint": "wss://YOUR_XRPL_RPC_ENDPOINT",
    "xummApiKey": "2abde023-0df1-49a2-a4dc-86d776f6318d",
    "sologenicApiBase": "https://api.sologenic.org",
    "networkName": "XRPL Mainnet"
  }
  </script>

  <!-- =========================
       EXTERNAL LIBS (SDKs)
       ========================= -->
  <script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
  <script src="https://unpkg.com/xrpl/dist/xrpl.min.js"></script>

  <!-- =========================
       APP SCRIPT
       ========================= -->
  <script>
  ;(function(){
     'use strict';
+ // ───────────────────────────────────────────────────────────────
+ // Quick test: grab “Connect Wallet” button and log clicks
+ const btnConnect = document.getElementById('btnConnect');
+
+ // Make sure it’s enabled for this test
+ btnConnect.disabled = false;
+
+ // Attach a simple click‐logger
+ btnConnect.addEventListener('click', () => {
+   console.log('Connect Wallet button clicked');
+ });
+ // ───────────────────────────────────────────────────────────────


    // --------------------------------
    // State & Configuration
    // --------------------------------
    const cfg = JSON.parse(document.getElementById('app-config').textContent);
    const state = {
      theme: localStorage.getItem('theme') || 'dark',
      wallet: {
        connected: false,
        account: null
      },
      xrpl: {
        client: null,
        connected: false,
        endpoint: cfg.rpcEndpoint
      },
      trustline: {
        exists: false,
        prepared: null,
        deeplink: null
      },
      amm: {
        id: null, // returned from AMMCreate (placeholder in demo)
        tvlUSD: null
      },
      market: {
        priceUSD: null
      },
      data: {
        alerts: []
      }
    };

    // --------------------------------
    // DOM Helpers
    // --------------------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const setText = (sel, txt) => { const el = $(sel); if (el) el.textContent = txt; };
    const setHTML = (sel, html) => { const el = $(sel); if (el) el.innerHTML = html; };
    const enable = (el, on=true) => { if (typeof el === 'string') el = $(el); if (el) el.disabled = !on; };
    const show = (el, on=true) => { if (typeof el === 'string') el = $(el); if (el) el.hidden = !on; };

    // --------------------------------
    // Routing
    // --------------------------------
    const routes = new Map();
    $$('[data-route]').forEach(s => routes.set(s.getAttribute('data-route'), s));
    function navigate(hash) {
      const key = (hash || location.hash || '#/home').replace(/^#\//,'');
      routes.forEach((el, name) => { el.hidden = (name !== key); });
      onRoute(key);
    }
    window.addEventListener('hashchange', () => navigate());
    document.addEventListener('DOMContentLoaded', () => {
      applyTheme(state.theme);
      bindUI();
      navigate();
      bootSim();
    });

    // --------------------------------
    // Theme
    // --------------------------------
    function applyTheme(mode) {
      if (mode !== 'dark' && mode !== 'light') mode = 'dark';
      document.documentElement.setAttribute('data-theme', mode);
      state.theme = mode;
      localStorage.setItem('theme', mode);
      $('#btnTheme').textContent = mode === 'dark' ? 'Light Mode' : 'Dark Mode';
    }

    // --------------------------------
    // XRPL & Wallet (Xaman/Xumm)
   // Initialize Xumm with your public API key
const xumm = new Xumm('2abde023-0df1-49a2-a4dc-86d776f6318d');

const connectWalletButton = document.getElementById('connectWalletButton');
const logoutButton = document.getElementById('logoutButton');
const walletAddressElement = document.getElementById('walletAddress');
const statusDiv = document.getElementById('status');

// Enable the connect button once SDK is loaded
xumm.on('ready', () => {
  statusDiv.textContent = 'Xumm SDK loaded and ready.';
  connectWalletButton.disabled = false;
});

// Connect wallet button triggers Xumm OAuth2 flow
connectWalletButton.onclick = () => {
  statusDiv.textContent = 'Connecting to Xaman/Xumm wallet...';
  xumm.authorize().catch(error => {
    statusDiv.textContent = 'Authorization failed: ' + error.message;
  });
};

// Success event on wallet connect
xumm.on('success', async () => {
  const account = await xumm.user.account;
  walletAddressElement.textContent = 'Wallet Connected: ' + account;
  connectWalletButton.style.display = 'none';
  logoutButton.style.display = '';
  statusDiv.textContent = 'Connected successfully.';
});

// Logout logic
logoutButton.onclick = () => {
  xumm.logout();
  statusDiv.textContent = 'Logging out...';
};

xumm.on('logout', () => {
  walletAddressElement.textContent = 'Status: Not connected';
  connectWalletButton.style.display = '';
  logoutButton.style.display = 'none';
  statusDiv.textContent = 'You have logged out.';
});


    // --------------------------------
    // Trustline
    // --------------------------------
    function buildTrustTx() {
      const code = $('#tlCode').value.trim();
      const issuer = $('#tlIssuer').value.trim();
      const limit = $('#tlLimit').value.trim();
      const currency = currencyCodeToXRPL(code);
      if (!state.wallet.account) { setStatus('Connect wallet first.', 'warn'); return null; }
      const tx = {
        TransactionType: 'TrustSet',
        Account: state.wallet.account,
        LimitAmount: { currency, issuer, value: limit }
      };
      return tx;
    }

    function buildTrustlineDeeplink() {
      const code = $('#tlCode').value.trim();
      const issuer = $('#tlIssuer').value.trim();
      const limit = $('#tlLimit').value.trim();
      if (!state.wallet.connected) return;
      const payload = {
        txjson: {
          TransactionType: 'TrustSet',
          Account: state.wallet.account,
          LimitAmount: {
            currency: currencyCodeToXRPL(code),
            issuer: issuer,
            value: limit
          }
        },
        options: { submit: true, expire: 10 }
      };
      // Deeplink format reference (placeholder): xumm://payload/create?json=...
      const deeplink = 'xumm://payload/create?json=' + encodeURIComponent(JSON.stringify(payload));
      state.trustline.deeplink = deeplink;
      setText('#xummDeeplink', deeplink);
      enable('#btnOpenXumm', true);
      enable('#btnCopyLink', true);
    }

    // --------------------------------
    // DEX (Offers & Path Payments)
    // --------------------------------
    function placeOrder() {
      if (!state.wallet.connected) return setStatus('Connect wallet first.', 'warn');
      if (!state.trustline.exists) return setStatus('Set trustline first.', 'warn');

      const type = $('#tradeType').value;
      const amount = parseFloat($('#tradeAmount').value);
      const price = parseFloat($('#tradePrice').value);
      if (!isFinite(amount) || amount <= 0 || !isFinite(price) || price <= 0) {
        return setStatus('Enter valid amount & price.', 'warn');
      }
      const xrpTotal = amount * price;
      // Demo: Show prepared offer; Production: OfferCreate with TakerGets/TakerPays
      const tx = {
        TransactionType: 'OfferCreate',
        Account: state.wallet.account,
        // Simplified example (actual XRPL requires Price math, IOU format, etc.)
        TakerGets: drops(xrpTotal),
        TakerPays: { currency: currencyCodeToXRPL(cfg.tokenCode), issuer: cfg.issuerAddress, value: String(amount) },
        Flags: type === 'sell' ? 0x00080000 : 0 // Sell flag as example
      };
      setStatus('Submitting order for signing...', 'info');
      openModalJSON('OfferCreate Preview', tx);
      // TODO: send to Xumm payload endpoint or sign with wallet if available
    }

    function quickSwap() {
      if (!state.wallet.connected) return setStatus('Connect wallet first.', 'warn');
      if (!state.trustline.exists) return setStatus('Set trustline first.', 'warn');

      const amount = parseFloat($('#tradeAmount').value);
      if (!isFinite(amount) || amount <= 0) return setStatus('Enter amount to swap.', 'warn');
      const deliver = { currency: currencyCodeToXRPL(cfg.tokenCode), issuer: cfg.issuerAddress, value: String(amount) };
      const tx = {
        TransactionType: 'PathPaymentStrictReceive',
        Account: state.wallet.account,
        Amount: deliver,
        Destination: state.wallet.account,
        SendMax: drops(amount * 2), // overshoot for demo
        Paths: []
      };
      setStatus('Preparing path payment (demo)...', 'info');
      openModalJSON('PathPaymentStrictReceive Preview', tx);
    }

    // --------------------------------
    // AMM
    // --------------------------------
    function ammCreate() {
      if (!state.wallet.connected) return setStatus('Connect wallet first.', 'warn');
      if (!state.trustline.exists) return setStatus('Set trustline first.', 'warn');

      const amtToken = $('#ammInitToken').value.trim() || '1000';
      const amtXRP = $('#ammInitXRP').value.trim() || '100000000';
      const fee = parseInt($('#ammFee').value, 10) || 30;
      const tx = {
        TransactionType: 'AMMCreate',
        Account: state.wallet.account,
        TradingFee: fee,
        Amount: { currency: currencyCodeToXRPL(cfg.tokenCode), issuer: cfg.issuerAddress, value: amtToken },
        Amount2: amtXRP
      };
      setStatus('Creating AMM pool (demo)...', 'info');
      openModalJSON('AMMCreate Preview', tx);
      // Demo assign fake AMM ID
      state.amm.id = 'AMM_' + Date.now();
      updatePoolDemo();
      updateActionGates();
    }

    function lpDeposit() {
      if (!state.wallet.connected) return setStatus('Connect wallet first.', 'warn');
      if (!state.trustline.exists) return setStatus('Set trustline first.', 'warn');
      if (!state.amm.id) return setStatus('Create or select a pool first.', 'warn');

      const xrbc = $('#lpXRBC').value.trim() || '500';
      const xrp = $('#lpXRP').value.trim() || '50000000';
      const tx = {
        TransactionType: 'AMMDeposit',
        Account: state.wallet.account,
        AMM: state.amm.id, // demo
        Amount: { currency: currencyCodeToXRPL(cfg.tokenCode), issuer: cfg.issuerAddress, value: xrbc },
        Amount2: xrp
      };
      setStatus('Depositing liquidity (demo)...', 'info');
      openModalJSON('AMMDeposit Preview', tx);
      // Demo portfolio mutation
      setHTML('#myLpBalance', 'You own <b>105.871 LP tokens</b>. Pool share: ~1.26%.');
    }

    function lpWithdraw() {
      if (!state.wallet.connected) return setStatus('Connect wallet first.', 'warn');
      if (!state.trustline.exists) return setStatus('Set trustline first.', 'warn');
      if (!state.amm.id) return setStatus('Create or select a pool first.', 'warn');

      const lp = $('#lpTokens').value.trim() || '50';
      const tx = {
        TransactionType: 'AMMWithdraw',
        Account: state.wallet.account,
        AMM: state.amm.id, // demo
        Amount: lp
      };
      setStatus('Withdrawing liquidity (demo)...', 'info');
      openModalJSON('AMMWithdraw Preview', tx);
      setHTML('#myLpBalance', `You own <b>${(105.871 - parseFloat(lp)).toFixed(3)} LP tokens</b>.`);
    }

    // --------------------------------
    // Market & Simulations
    // --------------------------------
    function bootSim() {
      $('#tlCode').value = cfg.tokenCode;
      $('#tlIssuer').value = cfg.issuerAddress;
      $('#tlLimit').value = cfg.tokenLimit;
      setText('#issuerShort', shortAddr(cfg.issuerAddress));
      updateBalancesDemo();
      updateMarketDemo();
      updateOrderbookDemo();
      updateTradesDemo();
      updatePoolDemo();
      updateActionGates();
    }

    function updateBalancesDemo() {
      const html = `
        <table class="table"><thead><tr><th>Asset</th><th>Balance</th></tr></thead><tbody>
          <tr><td>XRP</td><td>1,245.112340</td></tr>
          <tr><td>XRbitcoincash</td><td>84,221.000000</td></tr>
        </tbody></table>
      `;
      setHTML('#walletBalances', html);
      setHTML('#demoBalances', html);
    }

    function updateMarketDemo() {
      state.market.priceUSD = +(Math.random() * 0.05 + 0.005).toFixed(5);
      setText('#kpiPrice', `$${state.market.priceUSD.toFixed(5)}`);
      setText('#ticker', `XRBC/USD: $${state.market.priceUSD.toFixed(5)} · 24h: +${(Math.random()*8).toFixed(2)}% · Vol: ${(Math.random()*100000).toFixed(0)} XRBC`);
    }

    function updateOrderbookDemo() {
      const tb = $('#orderbookTable').querySelector('tbody');
      const rows = [];
      const sides = ['Buy','Sell'];
      for (let i=0;i<8;i++){
        const side = sides[i%2];
        const price = (0.10 + Math.random()*0.03).toFixed(5);
        const amt = (50 + Math.random()*900).toFixed(3);
        rows.push(`<tr><td>${side}</td><td>${price}</td><td>${amt}</td></tr>`);
      }
      tb.innerHTML = rows.join('');
    }

    function updateTradesDemo() {
      const tb = $('#tradesTable').querySelector('tbody');
      const rows = [];
      const sides = ['Buy','Sell'];
      for (let i=0;i<10;i++){
        const side = sides[Math.random()>0.5?0:1];
        const price = (0.10 + Math.random()*0.03).toFixed(5);
        const amt = (5 + Math.random()*250).toFixed(3);
        rows.push(`<tr><td>${timeStr()}</td><td>${side}</td><td>${price}</td><td>${amt}</td></tr>`);
      }
      tb.innerHTML = rows.join('');
    }

    function updatePoolDemo() {
      // Demo TVL & pool info
      const xrbc = (200000 + Math.random()*80000).toFixed(2);
      const xrp = (80000 + Math.random()*50000).toFixed(3);
      const tvlUSD = (parseFloat(xrp)/1 * 0.55) + (parseFloat(xrbc)*state.market.priceUSD);
      state.amm.tvlUSD = tvlUSD;
      setText('#kpiTVL', `$${withSep(tvlUSD.toFixed(0))}`);
      setHTML('#ammInfo', `
        Pool holds <b>${withSep(xrbc)} XRBC</b> + <b>${withSep(xrp)} XRP</b><br/>
        Your share: <b>1.22%</b> (102.233 LP tokens)<br/>
        <span class="ok">Fee: 0.30%. TVL: $${withSep(tvlUSD.toFixed(0))}. AMM is live (demo).</span>
      `);
      setHTML('#poolStats', `
        <table class="table">
          <tr><th>Liquidity</th><th>Volume 24h</th><th>Fees 24h</th></tr>
          <tr><td>${withSep(xrp)} XRP</td><td>${withSep((Math.random()*15000).toFixed(0))} XRBC</td><td>${(Math.random()*45).toFixed(2)} XRP</td></tr>
          <tr><td>${withSep(xrbc)} XRBC</td><td>${withSep((Math.random()*6000).toFixed(0))} XRP</td><td>${(Math.random()*30).toFixed(2)} XRBC</td></tr>
        </table>
      `);
    }

    // --------------------------------
    // UI Gates & Route Hooks
    // --------------------------------
    function updateActionGates() {
      const tlReady = state.wallet.connected; // in demo, allow build when connected
      $('#btnBuildTrust').disabled = !tlReady;
      $('#btnSignTrust').disabled = !tlReady;
      $('#btnOpenTrustLink').disabled = !tlReady || !state.trustline.deeplink;
      $('#btnCopyTrustLink').disabled = !tlReady || !state.trustline.deeplink;

      const dexReady = state.wallet.connected && state.trustline.exists;
      $('#tradeBtn').disabled = !dexReady;
      $('#swapBtn').disabled = !dexReady;

      const ammReady = dexReady;
      $('#btnCreatePool').disabled = !ammReady;
      $('#lpDepositBtn').disabled = !ammReady || !state.amm.id && false; // enable after created
      $('#lpWithdrawBtn').disabled = !ammReady || !state.amm.id;

      if (state.amm.id) {
        $('#lpDepositBtn').disabled = false;
        $('#lpWithdrawBtn').disabled = false;
      }
    }

    function onRoute(key) {
      switch (key) {
        case 'home':
          break;
        case 'wallet':
          // nothing specific
          break;
        case 'trustline':
          // ensure inputs reflect cfg
          break;
        case 'dex':
          updateOrderbookDemo();
          updateTradesDemo();
          break;
        case 'amm':
          updatePoolDemo();
          break;
        case 'market':
          updateMarketDemo();
          updateBalancesDemo();
          break;
        case 'settings':
          // sync toggles
          break;
        default:
          break;
      }
    }

    // --------------------------------
    // Bind UI
    // --------------------------------
    function bindUI() {
      $('#btnTheme').addEventListener('click', () => applyTheme(state.theme==='dark'?'light':'dark'));
      $('#btnConnect').addEventListener('click', () => xumm.authorize().catch(e => setStatus('Auth error: '+e.message,'error')));
      $('#btnAuthorize').addEventListener('click', () => xumm.authorize().catch(e => setStatus('Auth error: '+e.message,'error')));
      $('#btnLogout').addEventListener('click', () => xumm.logout());
