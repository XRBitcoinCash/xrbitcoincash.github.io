<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XRBC Coin Slingshot</title>
<style>
  body { margin:0; overflow:hidden; background:#222; }
  canvas { display:block; margin:0 auto; background:#87CEEB; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
<script>
const { Engine, Render, World, Bodies, Body, Constraint, Vector } = Matter;

// --- Engine & Renderer ---
const engine = Engine.create();
const world = engine.world;
const canvas = document.getElementById('gameCanvas');
const width = window.innerWidth;
const height = window.innerHeight;

const render = Render.create({
    canvas: canvas,
    engine: engine,
    options: { width: width, height: height, wireframes: false, background: '#87CEEB' }
});

// --- Borders ---
const wallThickness = 50;
const walls = [
    Bodies.rectangle(width/2, -wallThickness/2, width, wallThickness, { isStatic:true }),      // top
    Bodies.rectangle(width/2, height + wallThickness/2, width, wallThickness, { isStatic:true }), // bottom
    Bodies.rectangle(-wallThickness/2, height/2, wallThickness, height, { isStatic:true }),    // left
    Bodies.rectangle(width + wallThickness/2, height/2, wallThickness, height, { isStatic:true }) // right
];
World.add(world, walls);

// --- Ground / Catapult base ---
const base = Bodies.rectangle(200, height-100, 40, 20, { isStatic:true });
World.add(world, base);

// --- Coin ---
let coin = Bodies.circle(base.position.x, base.position.y - 50, 15, { restitution:0.8 });
World.add(world, coin);

// --- Slingshot constraint ---
let slingshot = Constraint.create({
    pointA: { x: base.position.x, y: base.position.y - 50 },
    bodyB: coin,
    stiffness: 0.05,
    length: 0
});
World.add(world, slingshot);

let isDragging = false;

// --- Mouse / touch control ---
canvas.addEventListener('mousedown', startDrag);
canvas.addEventListener('mousemove', duringDrag);
canvas.addEventListener('mouseup', endDrag);
canvas.addEventListener('touchstart', startDrag);
canvas.addEventListener('touchmove', duringDrag);
canvas.addEventListener('touchend', endDrag);

function startDrag(e){
    const x = e.clientX || e.touches[0].clientX;
    const y = e.clientY || e.touches[0].clientY;
    const distance = Vector.magnitude(Vector.sub({x,y}, coin.position));
    if(distance < 30) isDragging = true;
}

function duringDrag(e){
    if(!isDragging) return;
    const x = e.clientX || e.touches[0].clientX;
    const y = e.clientY || e.touches[0].clientY;
    Body.setPosition(coin, { x, y });
}

function endDrag(e){
    if(!isDragging) return;
    isDragging = false;
    World.remove(world, slingshot);

    // spawn new coin after 3 seconds
    setTimeout(()=>{
        coin = Bodies.circle(base.position.x, base.position.y - 50, 15, { restitution:0.8 });
        World.add(world, coin);
        slingshot = Constraint.create({
            pointA: { x: base.position.x, y: base.position.y - 50 },
            bodyB: coin,
            stiffness: 0.05,
            length: 0
        });
        World.add(world, slingshot);
    }, 3000);
}

// --- Run engine ---
Engine.run(engine);
Render.run(render);
</script>
</body>
</html>
